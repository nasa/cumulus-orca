"use strict";(self.webpackChunkorca_website=self.webpackChunkorca_website||[]).push([[7594],{3219:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"developer/deployment-guide/deployment-upgrading-orca","title":"Upgrading ORCA","description":"Provides developer with information on upgrading ORCA.","source":"@site/docs/developer/deployment-guide/deployment-upgrading-orca.md","sourceDirName":"developer/deployment-guide","slug":"/developer/deployment-guide/deployment-upgrading-orca","permalink":"/cumulus-orca/docs/developer/deployment-guide/deployment-upgrading-orca","draft":false,"unlisted":false,"editUrl":"https://github.com/nasa/cumulus-orca/edit/develop/website/docs/developer/deployment-guide/deployment-upgrading-orca.md","tags":[],"version":"current","frontMatter":{"id":"deployment-upgrading-orca","title":"Upgrading ORCA","description":"Provides developer with information on upgrading ORCA."},"sidebar":"dev_guide","previous":{"title":"Deploying ORCA with Cumulus","permalink":"/cumulus-orca/docs/developer/deployment-guide/deployment-with-cumulus"},"next":{"title":"Recovery Workflow","permalink":"/cumulus-orca/docs/developer/deployment-guide/recovery-workflow"}}');var o=r(4848),t=r(8453);const s={id:"deployment-upgrading-orca",title:"Upgrading ORCA",description:"Provides developer with information on upgrading ORCA."},a=void 0,l={},d=[{value:"ORCA Versioning",id:"orca-versioning",level:2},{value:"Migrating to a New Version",id:"migrating-to-a-new-version",level:2},{value:"Updating ORCA Version",id:"updating-orca-version",level:2},{value:"Update ORCA Resources",id:"update-orca-resources",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",li:"li",ol:"ol",p:"p",strong:"strong",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["After the initial ORCA deployment, any future updates to the ORCA deployment\nfrom configuration files, Terraform files (",(0,o.jsx)(n.code,{children:"*.tf"}),"), or modules from a new\nversion of ORCA can be deployed and will update the appropriate portions of\nthe stack as needed."]}),"\n",(0,o.jsx)(n.admonition,{title:"Ensure Cumulus Compatibility",type:"important",children:(0,o.jsxs)(n.p,{children:["Check for compatibility with the ",(0,o.jsx)(n.a,{href:"https://wiki.earthdata.nasa.gov/display/CUMULUS/Supported+PI+Versions",children:"Cumulus version"}),"."]})}),"\n",(0,o.jsx)(n.h2,{id:"orca-versioning",children:"ORCA Versioning"}),"\n",(0,o.jsx)(n.p,{children:"ORCA uses a global versioning approach, meaning version numbers are\nconsistent across all Terraform modules and semantic versioning to track\nmajor, minor, and patch version (e.g., 1.0.0)."}),"\n",(0,o.jsx)(n.admonition,{type:"important",children:(0,o.jsx)(n.p,{children:"ORCA major version releases (e.g., 2.x.x -> 3.x.x) introduce known breaking\nchanges. However, any version change has the possibility to introduce breaking\nchanges for your particular use case. It is critical that the release notes\nare viewed for migration steps and changes."})}),"\n",(0,o.jsxs)(n.p,{children:["Carefully read each 'Migration Notes'\nsection within the ",(0,o.jsx)(n.code,{children:"CHANGELOG.md"})," file, following all steps, starting with the oldest release after your\ncurrently installed release, and progressing through them chronologically."]}),"\n",(0,o.jsxs)(n.p,{children:["To view the released module artifacts for each ORCA core\nversion, see the ",(0,o.jsx)(n.a,{href:"https://github.com/nasa/cumulus-orca/releases",children:"ORCA Releases page"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"migrating-to-a-new-version",children:"Migrating to a New Version"}),"\n",(0,o.jsxs)(n.p,{children:["When breaking changes have been introduced, the ORCA Team will publish\ninstructions on migrating from one version to another. Detailed release notes\nwith migration instructions (if any) for each release can be found on the\n",(0,o.jsx)(n.a,{href:"https://github.com/nasa/cumulus-orca/releases",children:"ORCA Releases page"}),"."]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Use consistent ORCA versions:"})," All Terraform modules must be updated\nto the same ORCA version number (see Updating ORCA Version below). ",(0,o.jsx)(n.strong,{children:"Check\nthe CHANGELOG for deprecation/breaking change notices."})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Follow all intervening steps:"})," When skipping over versions, ",(0,o.jsx)(n.strong,{children:"you must\nperform all intervening migration steps."})," For example, if going from version\n1.1.0 to 1.3.0, upgrade from 1.1.0 to 1.2.0 and then to 1.3.0. This is\ncritical because each release that contains migration steps provide\ninstructions ",(0,o.jsx)(n.em,{children:"only"})," for migrating from the ",(0,o.jsx)(n.em,{children:"immediately"})," previous release,\nbut you must follow ",(0,o.jsx)(n.em,{children:"all"})," migration steps between your currently installed\nrelease and ",(0,o.jsx)(n.em,{children:"every release"})," through the release that you wish to migrate to."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Migrate lower environments first:"}),' Migrate your "lowest" environment\nfirst and test it to ensure correctness before performing migration steps in\neach successively higher environment. For example, update Sandbox, then UAT,\nthen SIT, and finally Prod.']}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Conduct smoke tests:"})," In each environment, perform smoke tests that\ngive you confidence that the upgrade was successful, prior to moving on to\nthe next environment. Since deployments can vary widely, it is up to you to\ndetermine tests that might be specific to your deployment."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Migrate during appropriate times:"})," Choose a time to migrate when\nsupport is more likely to be available in case you encounter problems, such\nas when you are most likely to be able to obtain support relatively promptly.\nPrefer earlier in the week over later in the week (particularly avoiding\nFridays, if possible)."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"updating-orca-version",children:"Updating ORCA Version"}),"\n",(0,o.jsx)(n.p,{children:"To update your ORCA version:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Find the desired release on the ",(0,o.jsx)(n.a,{href:"https://github.com/nasa/cumulus-orca/releases",children:"ORCA Releases page"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Update the ",(0,o.jsx)(n.code,{children:"source"})," in your Terraform deployment files for ORCA by\nreplacing ",(0,o.jsx)(n.code,{children:"vx.x.x"})," with the desired version of ORCA. If upgrading from ",(0,o.jsx)(n.code,{children:"v8.x.x"})," to ",(0,o.jsx)(n.code,{children:"v9.x.x"})," follow the below steps:"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Run the Lambda deletion script found in ",(0,o.jsx)(n.code,{children:"python3 bin/delete_lambda.py"})," this will delete all of the ORCA Lambdas with a provided prefix. Or delete them manually in the AWS console."]}),"\n",(0,o.jsx)(n.li,{children:"Navigate to the AWS console and search for the Cumulus RDS security group."}),"\n",(0,o.jsxs)(n.li,{children:["Remove the inbound rule with the source of ",(0,o.jsx)(n.code,{children:"PREFIX-vpc-ingress-all-egress"})," in Cumulus RDS security group."]}),"\n",(0,o.jsxs)(n.li,{children:["Search for ",(0,o.jsx)(n.code,{children:"PREFIX-vpc-ingress-all-egress"})," and delete the security group ",(0,o.jsx)(n.strong,{children:"NOTE:"})," Due to the Lambdas using ENIs, when deleting the securty groups it may say they are still associated with a Lambda that was deleted by the script. AWS may need a few minutes to refresh to fully disassociate the ENIs completely, if this error appears wait a few minutes and then try again."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Run ",(0,o.jsx)(n.code,{children:"terraform init"})," to get the latest copies of your updated modules."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"update-orca-resources",children:"Update ORCA Resources"}),"\n",(0,o.jsx)(n.admonition,{title:"Reminder",type:"note",children:(0,o.jsxs)(n.p,{children:["Remember to ",(0,o.jsx)(n.a,{href:"https://nasa.github.io/cumulus/docs/deployment/deployment-readme#initialize-terraform",children:"initialize Terraform"}),"\nif necessary."]})}),"\n",(0,o.jsxs)(n.p,{children:["From the directory of your ",(0,o.jsx)(n.code,{children:"cumulus"})," deployment module (e.g., ",(0,o.jsx)(n.code,{children:"cumulus-tf"}),"):"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"$ AWS_REGION=<region> \\ # e.g. us-west-2"}),"\n",(0,o.jsx)(n.code,{children:"AWS_PROFILE=<profile> \\"}),"\n",(0,o.jsx)(n.code,{children:"terraform apply"})]}),"\n",(0,o.jsx)(n.p,{children:"Once you have successfully updated all of your resources, verify that your\ndeployment functions correctly. Please refer to some recommended smoke tests\ngiven above and consider additional tests appropriate for your particular\ndeployment and environment."})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>a});var i=r(6540);const o={},t=i.createContext(o);function s(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);