"use strict";(self.webpackChunkorca_website=self.webpackChunkorca_website||[]).push([[6181],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>h});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=p(a),d=r,h=c["".concat(s,".").concat(d)]||c[d]||m[d]||o;return a?n.createElement(h,i(i({ref:t},u),{},{components:a})):n.createElement(h,i({ref:t},u))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[c]="string"==typeof e?e:r,i[1]=l;for(var p=2;p<o;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},5624:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const o={id:"versioning-releases",title:"ORCA Versioning and Releases",description:"Provides information to developers on semantic versioning and the release process."},i=void 0,l={unversionedId:"developer/development-guide/code/versioning-releases",id:"developer/development-guide/code/versioning-releases",title:"ORCA Versioning and Releases",description:"Provides information to developers on semantic versioning and the release process.",source:"@site/docs/developer/development-guide/code/versioning-releases.md",sourceDirName:"developer/development-guide/code",slug:"/developer/development-guide/code/versioning-releases",permalink:"/cumulus-orca/docs/developer/development-guide/code/versioning-releases",draft:!1,editUrl:"https://github.com/nasa/cumulus-orca/edit/develop/website/docs/developer/development-guide/code/versioning-releases.md",tags:[],version:"current",frontMatter:{id:"versioning-releases",title:"ORCA Versioning and Releases",description:"Provides information to developers on semantic versioning and the release process."},sidebar:"dev_guide",previous:{title:"Clean Architecture",permalink:"/cumulus-orca/docs/developer/development-guide/code/clean-architecture"},next:{title:"Running Pylint Against Your Code",permalink:"/cumulus-orca/docs/developer/development-guide/code/linting"}},s={},p=[{value:"Versioning",id:"versioning",level:2},{value:"Release Process",id:"release-process",level:2},{value:"Create a release branch",id:"create-a-release-branch",level:3},{value:"Update CHANGELOG.md",id:"update-changelogmd",level:3},{value:"Create a git tag for the release",id:"create-a-git-tag-for-the-release",level:3},{value:"Running the deployment",id:"running-the-deployment",level:3},{value:"Creating a Bamboo deployment plan branch",id:"creating-a-bamboo-deployment-plan-branch",level:4},{value:"Publish Documentation",id:"publish-documentation",level:2},{value:"Finalizing ORCA release on github",id:"finalizing-orca-release-on-github",level:2},{value:"Merge the base branch back into develop and master",id:"merge-the-base-branch-back-into-develop-and-master",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Delete and regenerate the tag",id:"delete-and-regenerate-the-tag",level:3},{value:"Deploying ORCA buckets, RDS cluster and Cumulus ORCA modules via bamboo",id:"deploying-orca-buckets-rds-cluster-and-cumulus-orca-modules-via-bamboo",level:2}],u={toc:p},c="wrapper";function m(e){let{components:t,...a}=e;return(0,r.kt)(c,(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"versioning"},"Versioning"),(0,r.kt)("p",null,"The ORCA team uses semantic versioning. More information about semantic\nversioning can be found ",(0,r.kt)("a",{parentName:"p",href:"https://semver.org/"},"here"),"."),(0,r.kt)("h2",{id:"release-process"},"Release Process"),(0,r.kt)("h3",{id:"create-a-release-branch"},"Create a release branch"),(0,r.kt)("p",null,"From develop, create a new release branch from develop following the\n",(0,r.kt)("inlineCode",{parentName:"p"},"release-MAJOR.MINOR.x"),". For example, ",(0,r.kt)("inlineCode",{parentName:"p"},"release-1.14.1"),". Push this branch\nto github if you created it locally."),(0,r.kt)("h3",{id:"update-changelogmd"},"Update CHANGELOG.md"),(0,r.kt)("p",null,"Update the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/nasa/cumulus-orca/blob/master/CHANGELOG.md"},"CHANGELOG.md"),".\nPut a header under the 'Unreleased' section with the new version number and\nthe date."),(0,r.kt)("h3",{id:"create-a-git-tag-for-the-release"},"Create a git tag for the release"),(0,r.kt)("p",null,"Make sure you're on the latest commit of the release branch."),(0,r.kt)("p",null,"Create and push a new git tag:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},' \xa0\xa0 git tag -a vx.y.z -m "Release x.y.z"\n \xa0\xa0 git push origin vx.y.z\n')),(0,r.kt)("h3",{id:"running-the-deployment"},"Running the deployment"),(0,r.kt)("p",null,"Publishing of new releases is handled by a Bamboo release plan and is manually\ntriggered."),(0,r.kt)("p",null,"If you created a new release branch in step one, you will need to create a new\nbamboo deployment plan."),(0,r.kt)("h4",{id:"creating-a-bamboo-deployment-plan-branch"},"Creating a Bamboo deployment plan branch"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"The deployment plan is already created in Bamboo using ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/nasa/cumulus-orca/tree/develop/bamboo-specs"},"Bamboo Specs"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"If you have updated the ",(0,r.kt)("inlineCode",{parentName:"p"},"bamboo.yaml")," config file, you will need to import the updated spec file from Bamboo specs UI. Under ",(0,r.kt)("inlineCode",{parentName:"p"},"Specs")," section, click on the ",(0,r.kt)("inlineCode",{parentName:"p"},"Set up Specs Repository"),". On the ",(0,r.kt)("inlineCode",{parentName:"p"},"Project Type"),", select ",(0,r.kt)("inlineCode",{parentName:"p"},"Build Project")," and then ",(0,r.kt)("inlineCode",{parentName:"p"},"ORCA"),". On the Specs repository, select the repository host as ",(0,r.kt)("inlineCode",{parentName:"p"},"orca-develop"),". Note that choosing the wrong repository branch will cause issues in deployment. ",(0,r.kt)("inlineCode",{parentName:"p"},"ORCA repo")," repository host is for ",(0,r.kt)("inlineCode",{parentName:"p"},"master")," branch and ",(0,r.kt)("inlineCode",{parentName:"p"},"orca test branch")," host is for ",(0,r.kt)("inlineCode",{parentName:"p"},"feature/ORCA-test-bamboo")," branch used for testing and prototyping. Contact ",(0,r.kt)("inlineCode",{parentName:"p"},"Venku Jayanti")," from CI/CD team for additional support.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the ORCA project (",(0,r.kt)("a",{parentName:"p",href:"https://ci.earthdata.nasa.gov/browse/ORCA-OI"},"https://ci.earthdata.nasa.gov/browse/ORCA-OI"),"), scroll to the top left of the page where it indicates ",(0,r.kt)("inlineCode",{parentName:"p"},"Plan branch"),". From the ",(0,r.kt)("inlineCode",{parentName:"p"},"Plan branch")," dropdown menu, select the release branch you created for the release which should be in the format ",(0,r.kt)("inlineCode",{parentName:"p"},"release-X.X.X"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Once inside the release branch page, scroll to the top right of the page and click ",(0,r.kt)("inlineCode",{parentName:"p"},"Actions"),"-> ",(0,r.kt)("inlineCode",{parentName:"p"},"Configure branch"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"On the ",(0,r.kt)("inlineCode",{parentName:"p"},"Plan branch configuration")," page, under ",(0,r.kt)("inlineCode",{parentName:"p"},"Plan branch configuration"),", enable 'Change Trigger'. Set the\n\xa0 Trigger type to manual, and this will prevent commits to the branch from triggering the build plan.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click on the ",(0,r.kt)("inlineCode",{parentName:"p"},"Variables")," tab.\nEnsure that you are on your branch plan and not the master plan. Click on the ",(0,r.kt)("inlineCode",{parentName:"p"},"Choose from inherited variables")," dropdown menu.\n\xa0 except in special cases such as incompatible backport branches. Then add and set the following variables:\n\xa0\xa0\xa0 ",(0,r.kt)("em",{parentName:"p"}," ORCA_VERSION: ",(0,r.kt)("inlineCode",{parentName:"em"},"<version number>"),"\n\xa0\xa0\xa0 ")," RELEASE_FLAG: true\n\xa0\xa0\xa0 ",(0,r.kt)("em",{parentName:"p"}," SECRET_GITHUB_EMAIL: ",(0,r.kt)("inlineCode",{parentName:"em"},"<secret github email>"),"\n\xa0\xa0\xa0 ")," SECRET_GITHUB_TOKEN: ",(0,r.kt)("inlineCode",{parentName:"p"},"<secret github token>"),"\n\xa0\xa0\xa0 * SECRET_GITHUB_USER: ",(0,r.kt)("inlineCode",{parentName:"p"},"<secret github user>")),(0,r.kt)("p",{parentName:"li"}," \xa0 Contact ORCA team to know values of the three github variables.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Run the branch using the 'Run' button in the top right."))),(0,r.kt)("p",null,"Bamboo will build and run unit tests against that tagged release."),(0,r.kt)("h2",{id:"publish-documentation"},"Publish Documentation"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Go to the ",(0,r.kt)("a",{parentName:"p",href:"https://ci.earthdata.nasa.gov/browse/ORCA-ROD"},(0,r.kt)("inlineCode",{parentName:"a"},"Release ORCA Documentation")," plan under ORCA"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click the ",(0,r.kt)("inlineCode",{parentName:"p"},"Create plan branch")," button next to the ",(0,r.kt)("inlineCode",{parentName:"p"},"Plan branch")," selector.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Choose your release branch and click ",(0,r.kt)("inlineCode",{parentName:"p"},"Create"),".\nMake sure to replace your bamboo github variables before running the pipeline.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click on the ",(0,r.kt)("inlineCode",{parentName:"p"},"Variables")," tab.\nEnsure that you are on your branch plan and not the master plan. Click on the ",(0,r.kt)("inlineCode",{parentName:"p"},"Choose from inherited variables")," dropdown menu.\n\xa0 except in special cases such as incompatible backport branches. Then add and set the following variables:\n\xa0\xa0\xa0 ",(0,r.kt)("em",{parentName:"p"}," SECRET_GITHUB_EMAIL: ",(0,r.kt)("inlineCode",{parentName:"em"},"<secret github email>"),"\n\xa0\xa0\xa0 ")," SECRET_GITHUB_TOKEN: ",(0,r.kt)("inlineCode",{parentName:"p"},"<secret github token>"),"\n\xa0\xa0\xa0 * SECRET_GITHUB_USER: ",(0,r.kt)("inlineCode",{parentName:"p"},"<secret github user>")),(0,r.kt)("p",{parentName:"li"}," \xa0 Contact ORCA team to know values of the three github variables.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Run the branch using the 'Run' button in the top right.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click on the ",(0,r.kt)("inlineCode",{parentName:"p"},"Tests")," tab, followed by the ",(0,r.kt)("inlineCode",{parentName:"p"},"Release ORCA Documentation.")," link.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Hit the play button next to the ",(0,r.kt)("inlineCode",{parentName:"p"},"Release Stage")," and run the stage."))),(0,r.kt)("h2",{id:"finalizing-orca-release-on-github"},"Finalizing ORCA release on github"),(0,r.kt)("p",null,"The release is automated in Bamboo, but the step must be manually started. If\nyou set the ",(0,r.kt)("inlineCode",{parentName:"p"},"RELEASE_FLAG")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," and the build steps passed, you will\nbe able to run the manual 'Release' step in Bamboo. Make sure to use the ",(0,r.kt)("inlineCode",{parentName:"p"},"ORCA Integrator")," plan under ORCA on bamboo website for performing a code release."),(0,r.kt)("p",null,"The CI release scripts will create a release based on the release version tag,\nas well as uploading release artifacts to the Github release for the Terraform\nmodules provided by Cumulus. The Terraform release artifacts include:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"A multi-module Terraform .zip artifact containing filtered copies of the\ntf-modules, packages, and tasks directories for use as Terraform module sources.")),(0,r.kt)("p",null,"Just make sure to verify the appropriate .zip files are present on Github after\nthe release process is complete."),(0,r.kt)("h2",{id:"merge-the-base-branch-back-into-develop-and-master"},"Merge the base branch back into develop and master"),(0,r.kt)("p",null,"If this is the latest version, you need to merge the version update changes back into master, then synchronize master and develop."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Create a PR to merge the release branch into master."),(0,r.kt)("li",{parentName:"ol"},"Once complete, create a PR to merge master into develop.\n\xa0 This should only contain changes from the release process.")),(0,r.kt)("admonition",{title:"Note:",type:"note"},(0,r.kt)("p",{parentName:"admonition"},'Do not squash this merge. Doing so will make the "compare" view from step 4\nshow an incorrect diff, because the tag is linked to a specific commit on the\nbase branch.')),(0,r.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,r.kt)("h3",{id:"delete-and-regenerate-the-tag"},"Delete and regenerate the tag"),(0,r.kt)("p",null,"To delete a published tag to re-tag, follow these steps:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"}," \xa0\xa0 git tag -d vx.y.z\n \xa0\xa0 git push -d origin vx.y.z\n")),(0,r.kt)("h2",{id:"deploying-orca-buckets-rds-cluster-and-cumulus-orca-modules-via-bamboo"},"Deploying ORCA buckets, RDS cluster and Cumulus ORCA modules via bamboo"),(0,r.kt)("p",null,"For testing purposes, you should use your feature branch in cumulus-orca github repo and ",(0,r.kt)("a",{parentName:"p",href:"https://ci.earthdata.nasa.gov/browse/ORCA-TODP"},(0,r.kt)("inlineCode",{parentName:"a"},"Test ORCA Deploy Plan"))," bamboo plan so that it does not affect the ORCA github ",(0,r.kt)("inlineCode",{parentName:"p"},"develop")," branch. The ",(0,r.kt)("inlineCode",{parentName:"p"},"Test ORCA Deploy Plan")," bamboo plan is linked to ",(0,r.kt)("inlineCode",{parentName:"p"},"feature/ORCA-test-bamboo")," github branch as the default branch under cumulus-orca repo."),(0,r.kt)("admonition",{type:"warning"},(0,r.kt)("p",{parentName:"admonition"},"You should reset ",(0,r.kt)("inlineCode",{parentName:"p"},"feature/ORCA-test-bamboo")," before using it."),(0,r.kt)("ol",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ol"},"Rename ",(0,r.kt)("inlineCode",{parentName:"li"},"feature/ORCA-test-bamboo")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"feature/ORCA-test-bamboo-old")),(0,r.kt)("li",{parentName:"ol"},"Create a new branch based off of your branch named ",(0,r.kt)("inlineCode",{parentName:"li"},"feature/ORCA-test-bamboo")),(0,r.kt)("li",{parentName:"ol"},"In the new branch's ",(0,r.kt)("inlineCode",{parentName:"li"},"bamboo.yaml"),":\nDelete all but one of the plans and the ",(0,r.kt)("inlineCode",{parentName:"li"},"ORCA-ODP")," plan.\nChange plan's ",(0,r.kt)("inlineCode",{parentName:"li"},"name")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"Test ORCA Deploy Plan"),".\nIn each ",(0,r.kt)("inlineCode",{parentName:"li"},"repositories")," element, change ",(0,r.kt)("inlineCode",{parentName:"li"},"orca-develop")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"orca test branch"),".\nIn each ",(0,r.kt)("inlineCode",{parentName:"li"},"plan")," element, change ",(0,r.kt)("inlineCode",{parentName:"li"},"OI"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"ODP")," in ",(0,r.kt)("inlineCode",{parentName:"li"},"key")," values to ",(0,r.kt)("inlineCode",{parentName:"li"},"TODP"),"."))),(0,r.kt)("p",null,"From the ",(0,r.kt)("inlineCode",{parentName:"p"},"feature/ORCA-test-bamboo")," plan branch in bamboo, click on ",(0,r.kt)("inlineCode",{parentName:"p"},"Create plan branch")," and enter your branch name which should appear in the dropdown menu. Select your branch and click ",(0,r.kt)("inlineCode",{parentName:"p"},"Create"),". Make sure the branch is enabled. Finally, save the plan configuration and run your feature branch for testing. If you are updating your bamboo spec yaml file, note that the change will not be accepted by bamboo if you are in your feature branch. You must checkout to the ",(0,r.kt)("inlineCode",{parentName:"p"},"feature/ORCA-test-bamboo")," branch first, merge develop branch into this branch to make sure it is up to date, commit your yaml file changes and then import from Bamboo Specs UI for that change to occur. This is because the spec file change can only be done in the default branch which is ",(0,r.kt)("inlineCode",{parentName:"p"},"feature/ORCA-test-bamboo")," in this case. However, any other code changes can be done in your feature branch and bamboo will accept that."),(0,r.kt)("p",null,"You will use the ",(0,r.kt)("inlineCode",{parentName:"p"},"ORCA Deploy Plan")," bamboo plan for deploying the resources."),(0,r.kt)("p",null,"After hitting the play button on ",(0,r.kt)("inlineCode",{parentName:"p"},"Deploy DR ORCA Buckets")," stage in bamboo plan, but before hitting ",(0,r.kt)("inlineCode",{parentName:"p"},"Run")," in the popup, replace the following variables with yours:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"PREFIX"),(0,r.kt)("li",{parentName:"ul"},"DR_AWS_ACCESS_KEY_ID"),(0,r.kt)("li",{parentName:"ul"},"DR_AWS_SECRET_ACCESS_KEY"),(0,r.kt)("li",{parentName:"ul"},"CUMULUS_AWS_ACCESS_KEY_ID"),(0,r.kt)("li",{parentName:"ul"},"CUMULUS_AWS_SECRET_ACCESS_KEY")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Hitting 'play' next to ",(0,r.kt)("inlineCode",{parentName:"p"},"Deploy DR ORCA buckets"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"Deploy Dev RDS Stack")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Deploy Dev Cumulus and ORCA Stack")," brings up a checkbox list to run multiple jobs at once. Note that none of the checkboxes should be checked. This is because some variables are sensitive and some will vary depending upon the user running the pipeline.")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"If you are targeting your personal feature branch, you may set these and future variables on the Plan Branch under ",(0,r.kt)("inlineCode",{parentName:"p"},"variables"),".\nOtherwise, keep personalized/sensitive values out of the main build.")),(0,r.kt)("p",null,"These are the ORCA buckets that will be created in the disaster recovery AWS account:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"<PREFIX>-orca-primary")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"<PREFIX>-orca-archive-worm")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"<PREFIX>-orca-reports")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"<PREFIX>-dr-tf-state")," (for storing the terraform state file in DR account)")),(0,r.kt)("p",null,"Some of these buckets have cross-account IAM policies attached so that they can be accessed from the other cumulus sandbox."),(0,r.kt)("p",null,"The Cumulus and TF buckets as well as dynamoDB table in cumulus OU account are created automatically in the Bamboo ",(0,r.kt)("inlineCode",{parentName:"p"},"Deploy Cumulus buckets and Cumulus and Orca modules")," stage.\nThese are the buckets that will be created in cumulus OU account:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"<PREFIX>-internal")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"<PREFIX>-level0")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"<PREFIX>-public")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"<PREFIX>-private")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"<PREFIX>-protected")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"<PREFIX>-tf-state")," (for storing the terraform state file in cumulus OU account)")),(0,r.kt)("p",null,"The above buckets can also be created manually if desired by the user. Make sure to use the proper AWS access keys for configuration before running the commands."),(0,r.kt)("p",null,"Buckets can be created using the following CLI command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"aws s3api create-bucket --bucket <BUCKET_NAME>\xa0 --region us-west-2 --create-bucket-configuration LocationConstraint=us-west-2\n")),(0,r.kt)("p",null,"The dynamodb table and bucket versioning can be created manually as well."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"}," \xa0 aws dynamodb create-table \\\n \xa0\xa0\xa0\xa0 --table-name <PREFIX>-tf-locks \\\n \xa0\xa0\xa0\xa0 --attribute-definitions AttributeName=LockID,AttributeType=S \\\n \xa0\xa0\xa0\xa0 --key-schema AttributeName=LockID,KeyType=HASH \\\n \xa0\xa0\xa0\xa0 --billing-mode PAY_PER_REQUEST \\\n \xa0\xa0\xa0\xa0 --region us-west-2\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"}," \xa0\xa0\xa0\xa0 aws s3api put-bucket-versioning \\\n \xa0\xa0 --bucket <PREFIX>-tf-state \\\n \xa0\xa0 --versioning-configuration Status=Enabled\n")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"*-tf-state")," buckets and dynamoDB tables will not be automatically removed by cleanup scripts.\nOnce you are done with your testing, and you have verified that cleanup is actually successful, manually delete these resources.")),(0,r.kt)("p",null,"After hitting the play button on ",(0,r.kt)("inlineCode",{parentName:"p"},"Deploy Cumulus buckets and Cumulus and Orca modules"),", but before hitting ",(0,r.kt)("inlineCode",{parentName:"p"},"Run")," in the popup, replace the following variables with yours:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"CUMULUS_AWS_ACCESS_KEY_ID"),(0,r.kt)("li",{parentName:"ul"},"CUMULUS_AWS_SECRET_ACCESS_KEY"),(0,r.kt)("li",{parentName:"ul"},"PREFIX"),(0,r.kt)("li",{parentName:"ul"},"DB_ADMIN_PASSWORD"),(0,r.kt)("li",{parentName:"ul"},"DB_USER_PASSWORD"),(0,r.kt)("li",{parentName:"ul"},"CUMULUS_ORCA_DEPLOY_TEMPLATE_VERSION")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"CUMULUS_ORCA_DEPLOY_TEMPLATE_VERSION")," is the branch you want to check out in the ",(0,r.kt)("a",{parentName:"p",href:"https://git.earthdata.nasa.gov/projects/ORCA/repos/cumulus-orca-deploy-template/browse"},"deployment repo")," such as ",(0,r.kt)("inlineCode",{parentName:"p"},"v11.1.1-v4.0.1"),"."),(0,r.kt)("p",null,"Note that the jobs may need to be run multiple times to get past deployment errors if there is one. If an error is raised saying ",(0,r.kt)("inlineCode",{parentName:"p"},"Cloudwatch log groups already exist"),", then manually delete all the cloudwatch log groups and corresponding lambdas having the same name as the log groups from the AWS console and retry running the job. If the deployment is successful, the pipeline will run ingest integration tests automatically in the next step."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"ORCA Cleanup Plan")," in bamboo has two stages named ",(0,r.kt)("inlineCode",{parentName:"p"},"Clean up ORCA buckets and modules")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Clean up DR ORCA buckets")," which can be run in sequence to remove most of the resources created by the deployment stages. Choose your feature branch and then run the pipeline. Remember to add the following AWS secrets keys for both Cumulus and DR accounts while running the pipeline."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"PREFIX"),(0,r.kt)("li",{parentName:"ul"},"CUMULUS_AWS_ACCESS_KEY_ID"),(0,r.kt)("li",{parentName:"ul"},"CUMULUS_AWS_SECRET_ACCESS_KEY"),(0,r.kt)("li",{parentName:"ul"},"DR_AWS_ACCESS_KEY_ID"),(0,r.kt)("li",{parentName:"ul"},"DR_AWS_SECRET_ACCESS_KEY"),(0,r.kt)("li",{parentName:"ul"},"CUMULUS_ORCA_DEPLOY_TEMPLATE_VERSION")),(0,r.kt)("p",null,"State buckets and lock tables will be left intact to aid in any cleanup issues/debugging.\nTo verify cleanup, check the stage logs for errors, and ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/ARG/latest/userguide/find-resources-to-tag.html"},"check the AWS environment for additional resources")," with the tag ",(0,r.kt)("inlineCode",{parentName:"p"},"Deployment=PREFIX"),"."))}m.isMDXComponent=!0}}]);