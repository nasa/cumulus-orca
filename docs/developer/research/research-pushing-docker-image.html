<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-developer/research/research-pushing-docker-image">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Notes on pushing and deploying docker images. | Operational Recovery Cloud Archive (ORCA)</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://nasa.github.io//cumulus-orca/docs/developer/research/research-pushing-docker-image"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Notes on pushing and deploying docker images. | Operational Recovery Cloud Archive (ORCA)"><meta data-rh="true" name="description" content="Research notes on pushing Docker images for end users"><meta data-rh="true" property="og:description" content="Research notes on pushing Docker images for end users"><link data-rh="true" rel="icon" href="/cumulus-orca/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://nasa.github.io//cumulus-orca/docs/developer/research/research-pushing-docker-image"><link data-rh="true" rel="alternate" href="https://nasa.github.io//cumulus-orca/docs/developer/research/research-pushing-docker-image" hreflang="en"><link data-rh="true" rel="alternate" href="https://nasa.github.io//cumulus-orca/docs/developer/research/research-pushing-docker-image" hreflang="x-default"><link rel="stylesheet" href="/cumulus-orca/assets/css/styles.8acaa92e.css">
<link rel="preload" href="/cumulus-orca/assets/js/runtime~main.92d34172.js" as="script">
<link rel="preload" href="/cumulus-orca/assets/js/main.106c8a82.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/cumulus-orca/"><div class="navbar__logo"><img src="/cumulus-orca/img/cumulus-orca-logo.svg" alt="ORCA site logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/cumulus-orca/img/cumulus-orca-logo.svg" alt="ORCA site logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Operational Recovery Cloud Archive (ORCA)</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/cumulus-orca/docs/about/introduction/orca-intro">About ORCA</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cumulus-orca/docs/developer/quickstart/developer-intro">Developer Guide</a><a class="navbar__item navbar__link" href="/cumulus-orca/docs/cookbook/cookbook-intro">ORCA Cookbooks</a><a class="navbar__item navbar__link" href="/cumulus-orca/docs/operator/operator-intro">Operator Guide</a><a href="https://github.com/nasa/cumulus-orca" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus-orca/docs/developer/quickstart/developer-intro">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus-orca/docs/developer/development-guide/code/contrib-code-intro">Development Guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus-orca/docs/developer/deployment-guide/deployment">Deployment Guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus-orca/docs/developer/api/orca-api">API Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/cumulus-orca/docs/developer/research/research-intro">Research</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus-orca/docs/developer/research/research-intro">Introduction to ORCA Research</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus-orca/docs/developer/research/research-localstack">Localstack Research Notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus-orca/docs/developer/research/research-APIGateway">API Gateway Research Notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus-orca/docs/developer/research/research-reconciliation">ORCA Reconciliation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus-orca/docs/developer/research/research-AuroraServerless">Aurora Serverless Research Notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus-orca/docs/developer/research/research-graphql">GraphQL Research Notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus-orca/docs/developer/research/research-multipart-chunksize">Multipart Chunksize Research Notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus-orca/docs/developer/research/research-bamboo">Bamboo specs Research Notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus-orca/docs/developer/research/research-lambda-container">Using Lambda functions as container research Notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus-orca/docs/developer/research/research-orca-delete-functionality">Research Notes on ORCA delete functionality.</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus-orca/docs/developer/research/research-bamboo-integration-tests">Research Notes on running integration tests in bamboo CI/CD</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus-orca/docs/developer/research/research-lambda-container">Using Lambda functions as container research Notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cumulus-orca/docs/developer/research/research-pushing-docker-image">Notes on pushing and deploying docker images.</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus-orca/docs/developer/research/research-s3-bucket-best-practices">S3 Future Direction/Best Practices</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus-orca/docs/developer/research/research-deep-archive-migration">Deep Archive Storage Migration Research Notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus-orca/docs/developer/research/research-logging-libraries">Logging Libraries Research Notes</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/cumulus-orca/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Research</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Notes on pushing and deploying docker images.</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Notes on pushing and deploying docker images.</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="deploying-ecr">Deploying ECR<a class="hash-link" href="#deploying-ecr" title="Direct link to heading">​</a></h2><p>ECR repo can be deploying using terraform as shown below.</p><div class="language-terraform codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-terraform codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;aws_ecr_repository&quot; &quot;prototype_repo&quot; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name                 = &quot;prototype_repo&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  image_scanning_configuration {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scan_on_push = false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">output &quot;ecr_repo_url&quot; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    value = aws_ecr_repository.prototype_repo.repository_url</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="github-packages">Github Packages<a class="hash-link" href="#github-packages" title="Direct link to heading">​</a></h2><p><a href="https://docs.github.com/en/packages/learn-github-packages/introduction-to-github-packages" target="_blank" rel="noopener noreferrer">Github packages</a> looks like a good platform to store public or private docker images. GitHub Packages usage is free for public packages. For private packages, each account on GitHub receives a certain amount of free storage and data transfer, depending on the product used with the account. Any usage beyond the included amounts is controlled by spending limits. Currently, this github package feature is already being used by our NASA <a href="https://github.com/orgs/nasa/packages" target="_blank" rel="noopener noreferrer">repository</a>.</p><p>The steps to push a docker image to github repository are shown below. Make sure Docker CLI is installed on your machine.</p><ul><li>Create a DockerFile that will create the image.</li></ul><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#This is a sample image</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">FROM alpine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">3.4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RUN apk update</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RUN apk add vim </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CMD </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">“echo”</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">”Sample image created”</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>Build the image using <code>docker build -t sample-image .</code>.</p></li><li><p>Once the image is there, the next step is to push to github. However, the user will first need to authenticate with github using a <code>personal access token</code>. See details <a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token" target="_blank" rel="noopener noreferrer">here</a> on how to create the token.</p><div class="theme-admonition theme-admonition-important alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>Github packages might need to be approved by NASA admins for use. In addition, proper permissions need to be granted to the token such as <code>write_package</code> in order to push to github.</p></div></div></li><li><p>Once the token is created, sign in to the github container registry using:</p></li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token builtin class-name" style="color:rgb(255, 203, 107)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">CR_PAT</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">YOUR_PERSONAL_TOKEN</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$CR_PAT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> login ghcr.io -u </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">GITHUB_USERNAME</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> --password-stdin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Replace <code>&lt;USERNAME&gt;</code> with your github username. It will show <code>Login Succeeded</code> upon success.</p><ul><li>Tag the docker image using the following format. Note that the format must be <code>ghcr.io/&lt;GITHUB_USERNAME&gt;/&lt;image_name&gt;:&lt;image_tag&gt;</code>. The image name must have the prefix <code>cumulus-orca/</code>. e.g. <code>cumulus-orca/&lt;image_name&gt;:&lt;image_tag&gt;</code>. Note that <code>&lt;image_tag&gt;</code> is the image version.</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> tag </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">image_name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> ghcr.io/</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">GITHUB_USERNAME</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">/</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">image_name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">image_tag</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># example using image name &quot;cumulus-orca/sample-image:latest&quot; and github username &quot;nasa&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> tag sample-image ghcr.io/nasa/cumulus-orca/sample-image:latest</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Finally push the image</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> push ghcr.io/username/sample-image</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>Make sure your username matches with your github username or else it will show error while pushing the image.</p></div></div><p>Once the image is pushed, it  can be view under <code>Packages</code> section in github. However, the image will be private by default. Click on the <code>package settings</code> page to change from private to public if needed.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pulling-from-github-repo-and-pushing-to-ecr">Pulling from Github repo and pushing to ECR<a class="hash-link" href="#pulling-from-github-repo-and-pushing-to-ecr" title="Direct link to heading">​</a></h2><p>Docker image in github repository can then be pulled by other users using</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> pull ghcr.io/</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">GITHUB_USERNAME</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">/</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">image_name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">TAG</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> pull ghcr.io/username/sample-image:latest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once image is pulled and ECR is deployed, login to ECR and then tag and push the image.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>Make sure to properly tag the image or else it will give an error.</p></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#login to ECR</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">aws ecr get-login-password --region </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">YOUR_REGION</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> login --username AWS --password-stdin </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">YOUR_AWS_ACCOUNT_ID</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">.dkr.ecr.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">YOUR_REGION</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">.amazonaws.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">aws ecr get-login-password --region us-west-2 </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> login --username AWS --password-stdin </span><span class="token number" style="color:rgb(247, 140, 108)">123456789</span><span class="token plain">.dkr.ecr.us-west-2.amazonaws.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#tag your local image with your ECR repo name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> tag </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">IMAGE_NAME</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">IMAGE_TAG</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">YOUR_AWS_ECR_REPO_URI</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">IMAGE_TAG</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> tag ghcr.io/username/sample-image:latest </span><span class="token number" style="color:rgb(247, 140, 108)">123456789</span><span class="token plain">.dkr.ecr.us-west-2.amazonaws.com/prototype_repo:prototype</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#push image to your ECR</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> push </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">YOUR_ECR_REPO_URI</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">IMAGE_TAG</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> push </span><span class="token number" style="color:rgb(247, 140, 108)">123456789</span><span class="token plain">.dkr.ecr.us-west-2.amazonaws.com/prototype_repo:prototype</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="alternative-approach-to-pull-and-push-images-to-ecr-using-packer">Alternative approach to pull and push images to ECR using Packer<a class="hash-link" href="#alternative-approach-to-pull-and-push-images-to-ecr-using-packer" title="Direct link to heading">​</a></h2><p>Another approach to pull, tag and push images from github repository to AWS ECR is to use Hashicorp <a href="https://www.packer.io/" target="_blank" rel="noopener noreferrer">Packer</a> that can automatically build and push docker images to AWS. It uses the HashiCorp Configuration Language (HCL). A sample working script named <code>test.pkr.hcl</code> deployed to AWS sandbox is shown below:</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Make sure the file name ends with &quot;.pkr.hcl&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">packer </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># install required plugins</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  required_plugins </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      version </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&gt;= 1.0.1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">source</span><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;github.com/hashicorp/docker&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">variable  </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ecr_repository_url&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">type</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  sensitive </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">variable  </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;image_version&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">type</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># pull the image from github repo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">source</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;docker&quot;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;prototype_image&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  image </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ghcr.io/rizbihassan/cumulus-orca/sample-image:latest&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  commit </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># build the image</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">build </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  sources </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;source.docker.prototype_image&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># tag the image</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  post-processors </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    post-processor </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;docker-tag&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        repository </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> var.ecr_repository_url</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        tags </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">var.image_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># push the image to ECR repo that was deployed using terraform previously</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    post-processor </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;docker-push&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ecr_login </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        login_server </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> var.ecr_repository_url</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Run the packer file using the command below. Replace <code>&lt;ECR_REPOSITORY_URL&gt;</code> and <code>&lt;IMAGE_VERSION&gt;</code> with yours.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">packer build -var </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;ecr_repository_url=&lt;ECR_REPOSITORY_URL&gt;&#x27;</span><span class="token plain"> -var </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;image_version=&lt;IMAGE_VERSION&gt;&#x27;</span><span class="token plain"> test.pkr.hcl</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The output will show something like this if successful:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">user$ packer build -var </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;ecr_repository_url=123456789.dkr.ecr.us-west-2.amazonaws.com/prototype_repo&#x27;</span><span class="token plain"> -var </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;image_version=v1&#x27;</span><span class="token plain"> test.pkr.hcl</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docker.prototype_image: output will be </span><span class="token keyword" style="font-style:italic">in</span><span class="token plain"> this color.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> docker.prototype_image: Creating a temporary directory </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> sharing data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> docker.prototype_image: Pulling Docker image: ghcr.io/rizbihassan/cumulus-orca/sample-image:latest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docker.prototype_image: latest: Pulling from rizbihassan/cumulus-orca/sample-image</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docker.prototype_image: Status: Image is up to </span><span class="token function" style="color:rgb(130, 170, 255)">date</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> ghcr.io/rizbihassan/cumulus-orca/sample-image:latest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docker.prototype_image: ghcr.io/rizbihassan/cumulus-orca/sample-image:latest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> docker.prototype_image: Starting </span><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> container</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docker.prototype_image: Run command: </span><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> run -v /Users/rhassan/.config/packer/tmp867764898:/packer-files -d -i -t --entrypoint</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">/bin/sh -- ghcr.io/rizbihassan/cumulus-orca/sample-image:latest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docker.prototype_image: Container ID: edbdd851c37304379f241adbec0ca4aecc601c92f7f0ea60d928b3be7ed13224</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> docker.prototype_image: Using </span><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> communicator to connect: </span><span class="token number" style="color:rgb(247, 140, 108)">172.17</span><span class="token plain">.0.3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> docker.prototype_image: Committing the container</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docker.prototype_image: Image ID: sha256:a68fd0613f72473f1f11bf81a87eedd308e8e0c7cc9d6568467ddd4e4df5c2aa</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> docker.prototype_image: Killing the container: edbdd851c37304379f241adbec0ca4aecc601c92f7f0ea60d928b3be7ed13224</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> docker.prototype_image: Running post-processor:  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">type docker-tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docker.prototype_image </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">docker-tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">: Tagging image: sha256:a68fd0613f72473f1f11bf81a87eedd308e8e0c7cc9d6568467ddd4e4df5c2aa</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docker.prototype_image </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">docker-tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">: Repository: </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">sensitive</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">:v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> docker.prototype_image: Running post-processor:  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">type docker-push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docker.prototype_image </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">docker-push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">: Fetching ECR credentials</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docker.prototype_image </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">docker-push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">: Logging in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docker.prototype_image </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">docker-push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">: Login Succeeded</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docker.prototype_image </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">docker-push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">: Pushing: </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">sensitive</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">:v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docker.prototype_image </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">docker-push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">: The push refers to repository </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">sensitive</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docker.prototype_image </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">docker-push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">: f2f1289d6a81: Preparing</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docker.prototype_image </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">docker-push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">: 4dda5747d6f4: Preparing</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docker.prototype_image </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">docker-push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">: dbb5c5e8d571: Preparing</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docker.prototype_image </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">docker-push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">: 23f7bd114e4a: Preparing</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docker.prototype_image </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">docker-push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">: f2f1289d6a81: Pushed</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docker.prototype_image </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">docker-push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">: v1: digest: sha256:29c151d20a3d1e8e525e9af4e7292f0e99d8f8cd64d7bcba289ceafc77a2ea98 size: </span><span class="token number" style="color:rgb(247, 140, 108)">1156</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docker.prototype_image </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">docker-push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">: Pushing: </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">sensitive</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">:v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docker.prototype_image </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">docker-push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">: The push refers to repository </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">sensitive</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docker.prototype_image </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">docker-push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">: f2f1289d6a81: Preparing</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docker.prototype_image </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">docker-push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">: 4dda5747d6f4: Preparing</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docker.prototype_image </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">docker-push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">: dbb5c5e8d571: Preparing</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docker.prototype_image </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">docker-push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">: 23f7bd114e4a: Preparing</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docker.prototype_image </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">docker-push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">: v1: digest: sha256:29c151d20a3d1e8e525e9af4e7292f0e99d8f8cd64d7bcba289ceafc77a2ea98 size: </span><span class="token number" style="color:rgb(247, 140, 108)">1156</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docker.prototype_image </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">docker-push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">: Logging out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docker.prototype_image </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">docker-push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">: Removing login credentials </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">236859827343</span><span class="token plain">.dkr.ecr.us-west-2.amazonaws.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Build </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;docker.prototype_image&#x27;</span><span class="token plain"> finished after </span><span class="token number" style="color:rgb(247, 140, 108)">13</span><span class="token plain"> seconds </span><span class="token number" style="color:rgb(247, 140, 108)">305</span><span class="token plain"> milliseconds.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> Wait completed after </span><span class="token number" style="color:rgb(247, 140, 108)">13</span><span class="token plain"> seconds </span><span class="token number" style="color:rgb(247, 140, 108)">305</span><span class="token plain"> milliseconds</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> Builds finished. The artifacts of successful builds are:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> docker.prototype_image: Imported Docker image: sha256:a68fd0613f72473f1f11bf81a87eedd308e8e0c7cc9d6568467ddd4e4df5c2aa</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> docker.prototype_image: Imported Docker image: </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">sensitive</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">:v1 with tags </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">sensitive</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">:v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prototyping-using-github-package">Prototyping using github package<a class="hash-link" href="#prototyping-using-github-package" title="Direct link to heading">​</a></h2><p>A prototype of a github package has been created by following the steps above and can be seen <a href="https://github.com/users/rizbihassan/packages/container/package/cumulus-orca/sample-image" target="_blank" rel="noopener noreferrer">here</a>. Note that a personal github account has been used for prototyping since it requires creating a personal access token first. The github repository containing image that was pulled from github repo above and pushed to ECR using packer can be found in the ECR console and is named <code>prototype_repo</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="future-directions-and-recommendations">Future directions and recommendations<a class="hash-link" href="#future-directions-and-recommendations" title="Direct link to heading">​</a></h2><p>Using github packages for storing docker container looks promising, easy to use and free of cost. However, the user will need to create a personal access token having proper permissions first to login to github package and push images which could cause some delay. No token is necessary to pull public images from github repository. While Docker CLI can be used to build and tag the image, it is not the ideal way to push to ECR. The better and automated approach would be using Packer as shown above. Once ECR is deployed with terraform, Packer can then be used to pull and push the image to ECR.
Some cards that  could be written are as follows:</p><ul><li>Create a personal access token(PAT) for github container registry with proper permissions. Work with NASA admins.</li><li>Push Docker images to github repository as needed.</li></ul><h5 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a class="hash-link" href="#references" title="Direct link to heading">​</a></h5><ul><li><a href="https://docs.github.com/en/packages/learn-github-packages/introduction-to-github-packages" target="_blank" rel="noopener noreferrer">https://docs.github.com/en/packages/learn-github-packages/introduction-to-github-packages</a></li><li><a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token" target="_blank" rel="noopener noreferrer">https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token</a></li><li><a href="https://docs.github.com/en/packages/learn-github-packages/configuring-a-packages-access-control-and-visibility#visibility-and-access-permissions-for-container-images" target="_blank" rel="noopener noreferrer">https://docs.github.com/en/packages/learn-github-packages/configuring-a-packages-access-control-and-visibility#visibility-and-access-permissions-for-container-images</a></li><li><a href="https://github.com/nasa/cumulus-orca/blob/develop/website/docs/developer/research/research-lambda-container.md" target="_blank" rel="noopener noreferrer">https://github.com/nasa/cumulus-orca/blob/develop/website/docs/developer/research/research-lambda-container.md</a></li><li><a href="https://www.packer.io/guides/hcl/variables" target="_blank" rel="noopener noreferrer">https://www.packer.io/guides/hcl/variables</a></li><li><a href="https://thoughtmechanix.com/posts/8.01.2021_packer/" target="_blank" rel="noopener noreferrer">https://thoughtmechanix.com/posts/8.01.2021_packer/</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/nasa/cumulus-orca/edit/develop/website/docs/developer/research/research-pushing-docker-image.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/cumulus-orca/docs/developer/research/research-lambda-container"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Using Lambda functions as container research Notes</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/cumulus-orca/docs/developer/research/research-s3-bucket-best-practices"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">S3 Future Direction/Best Practices</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#deploying-ecr" class="table-of-contents__link toc-highlight">Deploying ECR</a></li><li><a href="#github-packages" class="table-of-contents__link toc-highlight">Github Packages</a></li><li><a href="#pulling-from-github-repo-and-pushing-to-ecr" class="table-of-contents__link toc-highlight">Pulling from Github repo and pushing to ECR</a></li><li><a href="#alternative-approach-to-pull-and-push-images-to-ecr-using-packer" class="table-of-contents__link toc-highlight">Alternative approach to pull and push images to ECR using Packer</a></li><li><a href="#prototyping-using-github-package" class="table-of-contents__link toc-highlight">Prototyping using github package</a></li><li><a href="#future-directions-and-recommendations" class="table-of-contents__link toc-highlight">Future directions and recommendations</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/cumulus-orca/docs/about/introduction/orca-intro">About ORCA</a></li><li class="footer__item"><a class="footer__link-item" href="/cumulus-orca/docs/developer/quickstart/developer-intro">ORCA Developer Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/cumulus-orca/docs/cookbook/cookbook-intro">ORCA Cookbooks</a></li><li class="footer__item"><a class="footer__link-item" href="/cumulus-orca/docs/operator/operator-intro">ORCA Operator Guide</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://wiki.earthdata.nasa.gov/display/CUMULUS/ORCA+Working+Group" target="_blank" rel="noopener noreferrer" class="footer__link-item">ORCA Working Group<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/nasa/cumulus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cumulus Project<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://wiki.earthdata.nasa.gov/display/CUMULUS/Cumulus+Integrators+Working+Group" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cumulus Integrator Working Group<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://wiki.earthdata.nasa.gov/display/CUMULUS/Cumulus+Operator+Working+Group" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cumulus Operator Working Group<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://nasa.github.io/cumulus/docs/cumulus-docs-readme" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cumulus Documentation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/nasa/cumulus-orca" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
<script src="/cumulus-orca/assets/js/runtime~main.92d34172.js"></script>
<script src="/cumulus-orca/assets/js/main.106c8a82.js"></script>
</body>
</html>