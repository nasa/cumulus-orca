<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-developer/deployment-guide/deployment-with-cumulus">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<title data-rh="true">Deploying ORCA with Cumulus | Operational Recovery Cloud Archive (ORCA)</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://nasa.github.io//cumulus-orca/docs/developer/deployment-guide/deployment-with-cumulus"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Deploying ORCA with Cumulus | Operational Recovery Cloud Archive (ORCA)"><meta data-rh="true" name="description" content="Provides developer information for ORCA code deployment with Cumulus."><meta data-rh="true" property="og:description" content="Provides developer information for ORCA code deployment with Cumulus."><link data-rh="true" rel="icon" href="/cumulus-orca/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://nasa.github.io//cumulus-orca/docs/developer/deployment-guide/deployment-with-cumulus"><link data-rh="true" rel="alternate" href="https://nasa.github.io//cumulus-orca/docs/developer/deployment-guide/deployment-with-cumulus" hreflang="en"><link data-rh="true" rel="alternate" href="https://nasa.github.io//cumulus-orca/docs/developer/deployment-guide/deployment-with-cumulus" hreflang="x-default"><link rel="stylesheet" href="/cumulus-orca/assets/css/styles.a86b4f91.css">
<link rel="preload" href="/cumulus-orca/assets/js/runtime~main.f22ddc62.js" as="script">
<link rel="preload" href="/cumulus-orca/assets/js/main.76ed4be9.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/cumulus-orca/"><div class="navbar__logo"><img src="/cumulus-orca/img/cumulus-orca-logo.svg" alt="ORCA site logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/cumulus-orca/img/cumulus-orca-logo.svg" alt="ORCA site logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Operational Recovery Cloud Archive (ORCA)</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/cumulus-orca/docs/about/introduction/orca-intro">About ORCA</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cumulus-orca/docs/developer/quickstart/developer-intro">Developer Guide</a><a class="navbar__item navbar__link" href="/cumulus-orca/docs/cookbook/cookbook-intro">ORCA Cookbooks</a><a class="navbar__item navbar__link" href="/cumulus-orca/docs/operator/operator-intro">Operator Guide</a><a href="https://github.com/nasa/cumulus-orca" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus-orca/docs/developer/quickstart/developer-intro">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus-orca/docs/developer/development-guide/code/contrib-code-intro">Development Guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/cumulus-orca/docs/developer/deployment-guide/deployment">Deployment Guide</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus-orca/docs/developer/deployment-guide/deployment">Deployment Information</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus-orca/docs/developer/deployment-guide/deployment-environment">Creating a Deployment Environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus-orca/docs/developer/deployment-guide/deployment-s3-bucket">Creating the Glacier Bucket</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cumulus-orca/docs/developer/deployment-guide/deployment-with-cumulus">Deploying ORCA with Cumulus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus-orca/docs/developer/deployment-guide/deployment-upgrading-orca">Upgrading ORCA</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus-orca/docs/developer/deployment-guide/recovery-workflow">Recovery Workflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus-orca/docs/developer/deployment-guide/testing_deployment">Testing Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus-orca/docs/developer/deployment-guide/deploying-from-windows">Deploy from Windows</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus-orca/docs/developer/api/orca-api">API Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cumulus-orca/docs/developer/research/research-intro">Research</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/cumulus-orca/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Deployment Guide</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Deploying ORCA with Cumulus</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Deploying ORCA with Cumulus</h1></header><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</h5></div><div class="admonition-content"><p>Prior to following this document, make sure that your <a href="/cumulus-orca/docs/developer/deployment-guide/deployment-environment">deployment environment</a>
is setup and an <a href="/cumulus-orca/docs/developer/deployment-guide/deployment-s3-bucket">ORCA archive glacier bucket</a> is
created.</p></div></div><p>ORCA is meant to be deployed with Cumulus. To deploy ORCA add and/or modify the
files in the Cumulus <code>cumulus-tf</code> deployment.</p><p>The general steps to deploy and use ORCA are:</p><ol><li><a href="#configuring-the-orca-deployment">Configure the ORCA deployment.</a></li><li><a href="#define-the-orca-wokflows">Define the ORCA Ingest and Recovery workflows.</a></li><li><a href="#deploy-orca-with-terraform">Deploy ORCA using terraform.</a></li><li><a href="#collection-configuration">Configure ORCA in the collection configuration of the running Cumulus instance.</a></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-the-orca-deployment">Configuring the ORCA Deployment<a class="hash-link" href="#configuring-the-orca-deployment" title="Direct link to heading">​</a></h2><p>Follow the instructions for <a href="https://nasa.github.io/cumulus/docs/deployment/deployment-readme" target="_blank" rel="noopener noreferrer">deploying Cumulus</a>
on the Cumulus website through the configuration of the Cumulus module <code>cumulus-tf</code>.</p><p>Prior to deploying the <code>cumulus-tf</code> module, the following files need to be added
and/or modified to deploy ORCA with Cumulus.</p><ul><li>orca.tf</li><li>orca_variables.tf</li><li>terraform.tfvars</li><li>main.tf</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-cumulus-tforcatf">Creating <code>cumulus-tf/orca.tf</code><a class="hash-link" href="#creating-cumulus-tforcatf" title="Direct link to heading">​</a></h3><p>Create the <code>orca.tf</code> file in the <code>cumulus-tf</code> directory and copy the code below
into the new <code>orca.tf</code> file. Update the source variable with the preferred
ORCA version.</p><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Only change the value of source</h5></div><div class="admonition-content"><p>Only change the value of <code>source</code> in the code example below to point to the
proper ORCA version. The ORCA version is specified right after <em>download</em> in the
URL path to the release. In the example below the release being used is v3.0.2.</p></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Deploying a local version</h5></div><div class="admonition-content"><p>If you wish to deploy code cloned locally from <a href="https://github.com/nasa/cumulus-orca" target="_blank" rel="noopener noreferrer">Github</a> instead of a release zip, run
<code>./bin/build_tasks.sh</code>. This will crawl the <code>tasks</code> directory and build a <code>.zip</code> file (currently by just <code>zipping</code> all python files and dependencies) in each of it&#x27;s sub-directories. You may then set <code>source</code> to the root folder of your cloned Orca repository.</p></div></div><div class="language-terraform codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-terraform codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">## ORCA Module</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">## =============================================================================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">module &quot;orca&quot; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  source = &quot;https://github.com/nasa/cumulus-orca/releases/download/v3.0.2/cumulus-orca-terraform.zip&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ## --------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ## Cumulus Variables</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ## --------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ## REQUIRED</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  buckets                  = var.buckets</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  lambda_subnet_ids        = var.lambda_subnet_ids</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  permissions_boundary_arn = var.permissions_boundary_arn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  prefix                   = var.prefix</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  system_bucket            = var.system_bucket</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  vpc_id                   = var.vpc_id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  workflow_config          = module.cumulus.workflow_config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ## OPTIONAL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  tags        = var.tags</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ## --------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ## ORCA Variables</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ## --------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ## REQUIRED</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  db_admin_password        = var.db_admin_password</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  db_host_endpoint         = var.db_host_endpoint</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  db_user_password         = var.db_user_password</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  dlq_subscription_email   = var.dlq_subscription_email</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  orca_default_bucket      = var.orca_default_bucket</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  orca_reports_bucket_name = var.orca_reports_bucket_name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rds_security_group_id    = var.rds_security_group_id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ## OPTIONAL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # db_admin_username                                    = &quot;postgres&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # default_multipart_chunksize_mb                       = 250</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # metadata_queue_message_retention_time                = 777600</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # orca_default_recovery_type                           = &quot;Standard&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # orca_default_storage_class                           = &quot;GLACIER&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # orca_delete_old_reconcile_jobs_frequency_cron        = &quot;cron(0 0 ? * SUN *)&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # orca_ingest_lambda_memory_size                       = 2240</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # orca_ingest_lambda_timeout                           = 600</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # orca_internal_reconciliation_expiration_days         = 30</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # orca_reconciliation_lambda_memory_size               = 128</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # orca_reconciliation_lambda_timeout                   = 720</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # orca_recovery_buckets                                = []</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # orca_recovery_complete_filter_prefix                 = &quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # orca_recovery_expiration_days                        = 5</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # orca_recovery_lambda_memory_size                     = 128</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # orca_recovery_lambda_timeout                         = 720</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # orca_recovery_retry_limit                            = 3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # orca_recovery_retry_interval                         = 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # orca_recovery_retry_backoff                          = 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # s3_inventory_queue_message_retention_time_seconds    = 432000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # s3_report_frequency                                  = &quot;Daily&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # sqs_delay_time_seconds                               = 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # sqs_maximum_message_size                             = 262144</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # staged_recovery_queue_message_retention_time_seconds = 432000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # status_update_queue_message_retention_time_seconds   = 777600</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="required-values-unique-to-the-orca-module">Required Values Unique to the ORCA Module<a class="hash-link" href="#required-values-unique-to-the-orca-module" title="Direct link to heading">​</a></h4><p>The following variables are unique to the ORCA module and required to be set by
the user. More information about these required variables, as well as the
optional variables can be found in the <a href="#orca-variables">variables section</a>.</p><ul><li>db_admin_password</li><li>orca_default_bucket</li><li>orca_reports_bucket_name</li><li>db_user_password</li><li>db_host_endpoint</li><li>rds_security_group_id</li><li>dlq_subscription_email</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="required-values-retrieved-from-cumulus-variables">Required Values Retrieved from Cumulus Variables<a class="hash-link" href="#required-values-retrieved-from-cumulus-variables" title="Direct link to heading">​</a></h4><p>The following variables are set as part of your Cumulus deployment and are
required by the ORCA module. More information about setting these variables can
be found in the <a href="https://github.com/nasa/cumulus/blob/master/tf-modules/cumulus/variables.tf" target="_blank" rel="noopener noreferrer">Cumulus variable definitions</a>.
The variables must be set with the proper values in the <code>terraform.tfvars</code> file.</p><ul><li>buckets</li><li>lambda_subnet_ids</li><li>permissions_boundary_arn</li><li>prefix</li><li>system_bucket</li><li>vpc_id</li></ul><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Optional Cumulus Values</h5></div><div class="admonition-content"><p>The <code>tags</code> value automatically adds a <em>Deployment</em> tag like the Cumulus
deployment.</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="required-values-retrieved-from-other-modules">Required Values Retrieved from Other Modules<a class="hash-link" href="#required-values-retrieved-from-other-modules" title="Direct link to heading">​</a></h4><p>The following variables are set by retrieving output from other modules. This is
done so that the user does not have to lookup and set these variables after a
deployment. More information about these variables can be found in the
<a href="https://github.com/nasa/cumulus/blob/master/tf-modules/cumulus/variables.tf" target="_blank" rel="noopener noreferrer">Cumulus variable definitions</a>.</p><ul><li>workflow_config - Retrieved from the cumulus module in <code>main.tf</code>.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-cumulus-tforca_variablestf">Creating <code>cumulus-tf/orca_variables.tf</code><a class="hash-link" href="#creating-cumulus-tforca_variablestf" title="Direct link to heading">​</a></h3><p>In the <code>cumulus-tf</code> directory create the <code>orca_variables.tf</code> file. Copy the
contents below into the file so that the ORCA unique variables are defined.
For more information on the variables, see the <a href="#orca-variables">variables section</a>.</p><div class="language-terraform codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-terraform codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">## Variables unique to ORCA</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">## REQUIRED</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;db_admin_password&quot; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;Password for RDS database administrator authentication&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;db_user_password&quot; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;Password for RDS database user authentication&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;db_host_endpoint&quot; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;Database host endpoint to connect to.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;dlq_subscription_email&quot; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;The email to notify users when messages are received in dead letter SQS queue due to restore failure. Sends one email until the dead letter queue is emptied.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;orca_default_bucket&quot; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;Default ORCA S3 Glacier bucket to use.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;orca_reports_bucket_name&quot; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;The name of the bucket to store s3 inventory reports.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;rds_security_group_id&quot; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;Cumulus&#x27; RDS Security Group&#x27;s ID.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="modifying-cumulus-tfterraformtfvars">Modifying <code>cumulus-tf/terraform.tfvars</code><a class="hash-link" href="#modifying-cumulus-tfterraformtfvars" title="Direct link to heading">​</a></h3><p>At the end of the <code>terraform.tfvars</code> file, add the following code. Update the
required and optional variable values to the values needed for your particular
environment.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The example below shows the minimum variables to set for the module and accepting
default values for all of the optional items. The <a href="#orca-variables">ORCA variables section</a>
provides additional information on variables that can be set for the ORCA application.</p></div></div><div class="language-terraform codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-terraform codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">## =============================================================================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">## ORCA Variables</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">## =============================================================================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">## REQUIRED TO BE SET</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">## -----------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">## ORCA application database user password.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">db_user_password = &quot;my-super-secret-orca-application-user-password&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">## Default ORCA S3 Glacier bucket to use</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">orca_default_bucket = &quot;orca-archive-primary&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">## The name of the bucket to store s3 inventory reports.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">orca_reports_bucket_name = &quot;PREFIX-orca-reports&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">## PostgreSQL database (root) user password</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">db_admin_password = &quot;my-super-secret-database-owner-password&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">## PostgreSQL database host endpoint to connect to.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">db_host_endpoint = &quot;aws.postgresrds.host&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">## Cumulus&#x27; RDS Security Group&#x27;s ID.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rds_security_group_id = &quot;sg-01234567890123456&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">## Dead letter queue SNS topic subscription email.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dlq_subscription_email = &quot;test@email.com&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Below describes the type of value expected for each variable.</p><ul><li><code>db_user_password</code> (string) - the password for the application user.</li><li><code>orca_default_bucket</code> (string) - default S3 glacier bucket to use for ORCA data.</li><li><code>db_admin_password</code> (string) - password for the admin user.</li><li><code>db_host_endpoint</code>(string) - Database host endpoint to connect to.</li><li><code>db_user_password</code> (string) - the password for the application user.</li><li><code>dlq_subscription_email</code>(string) - &quot;The email to notify users when messages are received in dead letter SQS queue due to restore failure. Sends one email until the dead letter queue is emptied.&quot;</li><li><code>orca_default_bucket</code> (string) - Default S3 glacier bucket to use for ORCA data.</li><li><code>orca_reports_bucket_name</code> (string) - The name of the bucket to store s3 inventory reports.</li><li><code>rds_security_group_id</code>(string) - Cumulus&#x27; RDS Security Group&#x27;s ID. Output as <code>security_group_id</code> from the rds-cluster deployment.</li></ul><p>Additional variable definitions can be found in the <a href="#orca-variables">ORCA variables</a>
section of the document.</p><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</h5></div><div class="admonition-content"><p>The cumulus <code>buckets</code> variable will have to be modified to include the
disaster recovery buckets with a <em>type</em> of <strong>orca</strong>. An example can be seen below.
This addition is required for ORCA to have the proper bucket permissions to
work with Cumulus.</p><div class="language-terraform codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-terraform codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">buckets = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  orca_default = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name = &quot;orca-archive-primary&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    type = &quot;orca&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  internal = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name = &quot;orca-internal&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    type = &quot;internal&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  private = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name = &quot;orca-private&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    type = &quot;private&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  protected = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name = &quot;orca-protected&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    type = &quot;protected&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  public = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name = &quot;orca-public&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    type = &quot;public&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="modifying-cumulus-tfmaintf">Modifying cumulus-tf/main.tf<a class="hash-link" href="#modifying-cumulus-tfmaintf" title="Direct link to heading">​</a></h3><p>To use the Orca API, add the following line within the Cumulus module:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">module &quot;cumulus&quot; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  orca_api_uri = module.orca.orca_api_deployment_invoke_url</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="define-the-orca-workflows">Define the ORCA Workflows<a class="hash-link" href="#define-the-orca-workflows" title="Direct link to heading">​</a></h2><p>The ORCA Ingest Workflows follows each step listed below. Adding the Move
Granule Step and Add the Copy To Glacier Step are detailed in their respective
sections.</p><p><strong>ORCA Ingest Workflow</strong>
SyncGranule
FilesToGranuleStep
MoveGranuleStep
CopyToGlacier</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-the-move-granule-step-to-an-ingest-workflow">Add the Move Granule Step to an Ingest Workflow<a class="hash-link" href="#add-the-move-granule-step-to-an-ingest-workflow" title="Direct link to heading">​</a></h3><p>Navigate to <code>cumulus-tf/ingest_granule_workflow.tf</code> then add the following
step anywhere after the FilesToGranuleStep step being sure to change the
FilesToGranuleStep&#x27;s <code>&quot;Next&quot;</code> parameter equal to &quot;MoveGranuleStep&quot;.</p><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</h5></div><div class="admonition-content"><p>Adjust the <code>&quot;Next&quot;</code> step in the example below to point to the proper step in
the ingest workflow.</p></div></div><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token property">&quot;MoveGranuleStep&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;Parameters&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;cma&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;event.$&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;$&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;task_config&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;bucket&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{$.meta.buckets.internal.name}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;buckets&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{$.meta.buckets}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;distribution_endpoint&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{$.meta.distribution_endpoint}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;collection&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{$.meta.collection}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;duplicateHandling&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{$.meta.collection.duplicateHandling}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;s3MultipartChunksizeMb&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{$.meta.collection.meta.s3MultipartChunksizeMb}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;cumulus_message&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token property">&quot;outputs&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token property">&quot;source&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{$}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token property">&quot;destination&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{$.payload}&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token property">&quot;source&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{$.granules}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token property">&quot;destination&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{$.meta.processed_granules}&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;Type&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Task&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;Resource&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;${move_granules_task_arn}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;Retry&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;ErrorEquals&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Lambda.ServiceException&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Lambda.AWSLambdaException&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Lambda.SdkClientException&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;IntervalSeconds&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;MaxAttempts&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;BackoffRate&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;Catch&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;ErrorEquals&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;States.ALL&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;ResultPath&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;$.exception&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;Next&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;WorkflowFailed&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-the-copy-to-glacier-step-to-an-ingest-workflow">Add the Copy To Glacier Step to an Ingest Workflow<a class="hash-link" href="#add-the-copy-to-glacier-step-to-an-ingest-workflow" title="Direct link to heading">​</a></h3><p>Navigate to <code>cumulus-tf/ingest_granule_workflow.tf</code> then add the following step
anywhere after the MoveGranuleStep step being sure to change the MoveGranuleStep&#x27;s
<code>&quot;Next&quot;</code> parameter equal to &quot;CopyToGlacier&quot;.</p><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</h5></div><div class="admonition-content"><p>Adjust the <code>&quot;Next&quot;</code> step in the example below to point to the proper step in
the ingest workflow.</p></div></div><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token property">&quot;CopyToGlacier&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;Parameters&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;cma&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;event.$&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;$&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;task_config&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;excludeFileTypes&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{$.meta.collection.meta.excludeFileTypes}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;s3MultipartChunksizeMb&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{$.meta.collection.meta.s3MultipartChunksizeMb}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;providerId&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{$.meta.provider.id}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;providerName&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{$.meta.provider.name}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;executionId&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{$.cumulus_meta.execution_name}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;collectionShortname&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{$.meta.collection.name}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;collectionVersion&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{$.meta.collection.version}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;orcaDefaultBucketOverride&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{$.meta.collection.meta.orcaDefaultBucketOverride}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;Type&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Task&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;Resource&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;module.orca.orca_lambda_copy_to_glacier_arn&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;Catch&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;ErrorEquals&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;States.ALL&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;ResultPath&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;$.exception&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;Next&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;WorkflowFailed&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;Retry&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;ErrorEquals&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;States.ALL&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;IntervalSeconds&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;MaxAttempts&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;BackoffRate&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;Next&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;WorkflowSucceeded&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>See the copy_to_glacier json schema <a href="https://github.com/nasa/cumulus-orca/blob/master/tasks/copy_to_glacier/schemas/config.json" target="_blank" rel="noopener noreferrer">configuration file</a>, <a href="https://github.com/nasa/cumulus-orca/blob/master/tasks/copy_to_glacier/schemas/input.json" target="_blank" rel="noopener noreferrer">input file</a>  and <a href="https://github.com/nasa/cumulus-orca/blob/master/tasks/copy_to_glacier/schemas/output.json" target="_blank" rel="noopener noreferrer">output file</a> for more information.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="modify-the-recovery-workflow-optional">Modify the Recovery Workflow (<em>OPTIONAL</em>)<a class="hash-link" href="#modify-the-recovery-workflow-optional" title="Direct link to heading">​</a></h3><p>It is not recommended to modify the ORCA Recovery Workflow. The workflow JSON
file is located in the <code>modules/workflows/OrcaRecoveryWorkflow</code> of the repository.
The workflow file name is <code>orca_recover_workflow.asl.json</code>. To change the
behavior of the workflow, it is recommended to modify or replace the
<code>copy_files_to_archive</code> lambda.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="workflow-failures">Workflow Failures<a class="hash-link" href="#workflow-failures" title="Direct link to heading">​</a></h3><p>Failures within ORCA break through to the Cumulus workflow they are a part
of. More information on addressing workflow failures can be found on the
ORCA <a href="/cumulus-orca/docs/developer/development-guide/code/best-practices">Best Practices</a>
page.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="orca-variables">ORCA Variables<a class="hash-link" href="#orca-variables" title="Direct link to heading">​</a></h2><p>The following sections detail the variables used by the ORCA module.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="required-variables">Required Variables<a class="hash-link" href="#required-variables" title="Direct link to heading">​</a></h3><p>The following variables are required for the ORCA module and must be set to valid
values.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cumulus-required-variables">Cumulus Required Variables<a class="hash-link" href="#cumulus-required-variables" title="Direct link to heading">​</a></h4><p>The following variables should be present already in the <code>cumulus-tf/terraform.tfvars</code>
file. The variables must be set with proper values for your environment in the
<code>cumulus-tf/terraform.tfvars</code> file.</p><table><thead><tr><th>Variable</th><th>Definition</th><th>Example Value</th></tr></thead><tbody><tr><td><code>buckets</code></td><td>Mapping of all S3 buckets used by Cumulus and ORCA that contains a S3 <code>name</code> and <code>type</code>. A bucket with a <code>type</code> of <strong>orca</strong> is required.</td><td><code>buckets = { orca_default = { name = &quot;PREFIX-orca-primary&quot;, type = &quot;orca&quot;, ...}}</code></td></tr><tr><td><code>lambda_subnet_ids</code></td><td>A list of subnets that the Lambda&#x27;s and the database have access to for working with Cumulus.</td><td>[&quot;subnet-12345&quot;, &quot;subnet-abc123&quot;]</td></tr><tr><td><code>permissions_boundary_arn</code></td><td>AWS ARN value of the permission boundary for the VPC account.</td><td>&quot;arn:aws:iam::1234567890:policy/NGAPShRoleBoundary&quot;</td></tr><tr><td><code>prefix</code></td><td>Prefix that will be pre-pended to resource names created by terraform.</td><td>&quot;daac-sndbx&quot;</td></tr><tr><td><code>system_bucket</code></td><td>Cumulus system bucket used to store internal files and configurations for deployments.</td><td>&quot;PREFIX-internal&quot;</td></tr><tr><td><code>vpc_id</code></td><td>ID of VPC to place resources in - recommended that this be a private VPC (or at least one with restricted access).</td><td>&quot;vpc-abc123456789&quot;</td></tr><tr><td><code>workflow_config</code></td><td>Configuration object with ARNs for workflow integration (Role ARN for executing workflows and Lambda ARNs to trigger on workflow execution).</td><td>module.cumulus.workflow_config</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="orca-required-variables">ORCA Required Variables<a class="hash-link" href="#orca-required-variables" title="Direct link to heading">​</a></h4><p>The following variables should be present in the <code>cumulus-tf/orca_variables.tf</code>
file. The variables must be set with proper values for your environment in the
<code>cumulus-tf/terraform.tfvars</code> file.</p><table><thead><tr><th>Variable</th><th>Definition</th><th>Example Value</th></tr></thead><tbody><tr><td><code>db_admin_password</code></td><td>Password for RDS database administrator authentication</td><td>&quot;My_Sup3rS3cr3t_admin_Passw0rd&quot;</td></tr><tr><td><code>db_host_endpoint</code></td><td>Database host endpoint to connect to.</td><td>&quot;aws.postgresrds.host&quot;</td></tr><tr><td><code>db_user_password</code></td><td>Password for RDS database user authentication</td><td>&quot;My_Sup3rS3cr3tuserPassw0rd&quot;</td></tr><tr><td><code>dlq_subscription_email</code></td><td>The email to notify users when messages are received in dead letter SQS queue</td><td>&quot;<a href="mailto:test@email.com" target="_blank" rel="noopener noreferrer">test@email.com</a>&quot;</td></tr><tr><td><code>orca_default_bucket</code></td><td>Default ORCA S3 Glacier bucket to use.</td><td>&quot;PREFIX-orca-primary&quot;</td></tr><tr><td><code>orca_reports_bucket_name</code></td><td>The Name of the bucket to store s3 inventory reports.</td><td>&quot;PREFIX-orca-reports&quot;</td></tr><tr><td><code>rds_security_group_id</code></td><td>Cumulus&#x27; RDS Security Group&#x27;s ID.</td><td>&quot;sg-01234567890123456&quot;</td></tr><tr><td><code>s3_access_key</code></td><td>Access key for communicating with Orca S3 buckets.</td><td></td></tr><tr><td><code>s3_secret_key</code></td><td>Secret key for communicating with Orca S3 buckets.</td><td></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="optional-variables">Optional Variables<a class="hash-link" href="#optional-variables" title="Direct link to heading">​</a></h3><p>The following variables are optional for the ORCA module and can be set by the
end user to better adjust ORCA for their specific environment.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cumulus-optional-variables">Cumulus Optional Variables<a class="hash-link" href="#cumulus-optional-variables" title="Direct link to heading">​</a></h4><p>The following variables should be present already in the <code>cumulus-tf/terrafor.tfvars</code>
file. The variables can be set with proper values for your environment in the
<code>cumulus-tf/terraform.tfvars</code> file. It is recommended that the <code>region</code> variable
is set to the proper AWS region for deployments.</p><table><thead><tr><th>Variable</th><th>Definition</th><th>Example Value</th></tr></thead><tbody><tr><td><code>tags</code></td><td>Tags to be applied to resources that support tags.</td><td><code>{ environment = &quot;development&quot;, developer = &quot;me&quot; }</code></td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="orca-optional-variables">ORCA Optional Variables<a class="hash-link" href="#orca-optional-variables" title="Direct link to heading">​</a></h4><p>The following variables should be present in the <code>cumulus-tf/orca_variables.tf</code>
file. The variables can be set with proper values for your environment in the
<code>cumulus-tf/terraform.tfvars</code> file. The default setting for each of the optional
variables is shown in the table below.</p><table><thead><tr><th>Variable</th><th>Type</th><th>Definition</th><th>Default</th></tr></thead><tbody><tr><td><code>db_admin_username</code></td><td>string</td><td>Username for RDS database administrator authentication.</td><td>&quot;postgres&quot;</td></tr><tr><td><code>default_multipart_chunksize_mb</code></td><td>number</td><td>The default maximum size of chunks to use when copying. Can be overridden by collection config.</td><td>250</td></tr><tr><td><code>internal_report_queue_message_retention_time_seconds</code></td><td>number</td><td>Number of seconds the internal-report-queue SQS retains a message.</td><td>432000</td></tr><tr><td><code>metadata_queue_message_retention_time_seconds</code></td><td>number</td><td>Number of seconds the metadata-queue fifo SQS retains a message.</td><td>777600</td></tr><tr><td><code>db_name</code></td><td>string</td><td>The name of the Orca database within the RDS cluster. Any <code>-</code> in <code>prefix</code> will be replaced with <code>_</code>.</td><td>PREFIX_orca</td></tr><tr><td><code>db_user_name</code></td><td>string</td><td>The name of the application user for the Orca database. Any <code>-</code> in <code>prefix</code> will be replaced with <code>_</code>.</td><td>PREFIX_orcauser</td></tr><tr><td><code>orca_default_recovery_type</code></td><td>string</td><td>The Tier for the restore request. Valid values are &#x27;Standard&#x27;</td><td>&#x27;Bulk&#x27;</td></tr><tr><td><code>orca_default_storage_class</code></td><td>string</td><td>The <a href="/cumulus-orca/docs/operator/storage-classes">class of storage</a> to use when ingesting files. Can be overridden by collection config.</td><td>&quot;GLACIER&quot;</td></tr><tr><td><code>orca_delete_old_reconcile_jobs_frequency_cron</code></td><td>string</td><td>Frequency cron for running the delete_old_reconcile_jobs lambda.</td><td>&quot;cron(0 0 ? <em> SUN </em>)&quot;</td></tr><tr><td><code>orca_ingest_lambda_memory_size</code></td><td>number</td><td>Amount of memory in MB the ORCA copy_to_glacier lambda can use at runtime.</td><td>2240</td></tr><tr><td><code>orca_ingest_lambda_timeout</code></td><td>number</td><td>Timeout in number of seconds for ORCA copy_to_glacier lambda.</td><td>600</td></tr><tr><td><code>orca_internal_reconciliation_expiration_days</code></td><td>number</td><td>Only reports updated before this many days ago will be deleted.</td><td>30</td></tr><tr><td><code>orca_reconciliation_lambda_memory_size</code></td><td>number</td><td>Amount of memory in MB the ORCA reconciliation lambda can use at runtime.</td><td>128</td></tr><tr><td><code>orca_reconciliation_lambda_timeout</code></td><td>number</td><td>Timeout in number of seconds for ORCA reconciliation lambdas.</td><td>720</td></tr><tr><td><code>orca_recovery_buckets</code></td><td>List (string)</td><td>List of bucket names that ORCA has permissions to restore data to. Default is all in the <code>buckets</code> map.</td><td>[]</td></tr><tr><td><code>orca_recovery_complete_filter_prefix</code></td><td>string</td><td>Specifies object key name prefix by the Glacier Bucket trigger.</td><td>&quot;&quot;</td></tr><tr><td><code>orca_recovery_expiration_days</code></td><td>number</td><td>Number of days a recovered file will remain available for copy.</td><td>5</td></tr><tr><td><code>orca_recovery_lambda_memory_size</code></td><td>number</td><td>Amount of memory in MB the ORCA recovery lambda can use at runtime.</td><td>128</td></tr><tr><td><code>orca_recovery_lambda_timeout</code></td><td>number</td><td>Timeout in number of seconds for ORCA recovery lambdas.</td><td>720</td></tr><tr><td><code>orca_recovery_retry_limit</code></td><td>number</td><td>Maximum number of retries of a recovery failure before giving up.</td><td>3</td></tr><tr><td><code>orca_recovery_retry_interval</code></td><td>number</td><td>Number of seconds to wait between recovery failure retries.</td><td>1</td></tr><tr><td><code>orca_recovery_retry_backoff</code></td><td>number</td><td>The multiplier by which the retry interval increases during each attempt.</td><td>2</td></tr><tr><td><code>s3_inventory_queue_message_retention_time_seconds</code></td><td>number</td><td>The number of seconds s3-inventory-queue fifo SQS retains a message in seconds. Maximum value is 14 days.</td><td>432000</td></tr><tr><td><code>s3_report_frequency</code></td><td>string</td><td>How often to generate s3 reports for internal reconciliation. <code>Daily</code> or <code>Weekly</code></td><td>Daily</td></tr><tr><td><code>sqs_delay_time_seconds</code></td><td>number</td><td>Number of seconds that the delivery of all messages in the queue will be delayed.</td><td>0</td></tr><tr><td><code>sqs_maximum_message_size</code></td><td>number</td><td>The limit of how many bytes a message can contain before Amazon SQS rejects it.</td><td>262144</td></tr><tr><td><code>staged_recovery_queue_message_retention_time_seconds</code></td><td>number</td><td>Number of seconds the staged-recovery-queue fifo SQS retains a message.</td><td>432000</td></tr><tr><td><code>status_update_queue_message_retention_time_seconds</code></td><td>number</td><td>Number of seconds the status_update_queue fifo SQS retains a message.</td><td>777600</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="orca-module-outputs">ORCA Module Outputs<a class="hash-link" href="#orca-module-outputs" title="Direct link to heading">​</a></h2><p>The orca module provides the outputs seen below in the table. Outputs are
accessed using terraform dot syntax in the format of <code>module.orca.variable_name</code>.</p><table><thead><tr><th>Output Variable</th><th>Description</th></tr></thead><tbody><tr><td><code>orca_api_deployment_invoke_url</code></td><td>The URL to invoke the ORCA Cumulus reconciliation API gateway. Excludes the resource path</td></tr><tr><td><code>orca_lambda_copy_to_glacier_arn</code></td><td>AWS ARN of the ORCA copy_to_glacier lambda.</td></tr><tr><td><code>orca_lambda_extract_filepaths_for_granule_arn</code></td><td>AWS ARN of the ORCA extract_filepaths_for_granule lambda.</td></tr><tr><td><code>orca_lambda_orca_catalog_reporting_arn</code></td><td>AWS ARN of the ORCA orca_catalog_reporting lambda.</td></tr><tr><td><code>orca_lambda_request_files_arn</code></td><td>AWS ARN of the ORCA request_files lambda.</td></tr><tr><td><code>orca_lambda_copy_files_to_archive_arn</code></td><td>AWS ARN of the ORCA copy_files_to_archive lambda.</td></tr><tr><td><code>orca_lambda_request_status_for_granule_arn</code></td><td>AWS ARN of the ORCA request_status_for_granule lambda.</td></tr><tr><td><code>orca_lambda_request_status_for_job_arn</code></td><td>AWS ARN of the ORCA request_status_for_job lambda.</td></tr><tr><td><code>orca_lambda_post_copy_request_to_queue_arn</code></td><td>AWS ARN of the ORCA post_copy_request_to_queue lambda.</td></tr><tr><td><code>orca_lambda_orca_catalog_reporting_arn</code></td><td>AWS ARN of the ORCA orca_catalog_reporting lambda.</td></tr><tr><td><code>orca_secretsmanager_arn</code></td><td>The Amazon Resource Name (ARN) of the AWS secretsmanager</td></tr><tr><td><code>orca_sqs_metadata_queue_arn</code></td><td>The ARN of the metadata-queue SQS</td></tr><tr><td><code>orca_sqs_metadata_queue_id</code></td><td>The URL ID of the metadata-queue SQS</td></tr><tr><td><code>orca_sqs_staged_recovery_queue_arn</code></td><td>The ARN of the staged-recovery-queue SQS</td></tr><tr><td><code>orca_sqs_staged_recovery_queue_id</code></td><td>The URL ID of the staged-recovery-queue SQS</td></tr><tr><td><code>orca_sqs_status_update_queue_arn</code></td><td>The ARN of the status-update-queue SQS</td></tr><tr><td><code>orca_sqs_status_update_queue_id</code></td><td>The URL ID of the status-update-queue SQS</td></tr><tr><td><code>orca_subnet_group_id</code></td><td>The ORCA database subnet group name</td></tr><tr><td><code>orca_subnet_group_arn</code></td><td>The ARN of the ORCA database subnet group</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-orca-with-terraform">Deploy ORCA with Terraform<a class="hash-link" href="#deploy-orca-with-terraform" title="Direct link to heading">​</a></h2><p>In the proper module directory, initialize and apply changes using the commands
below.</p><ol><li>Run <code>terraform init</code>.</li><li>Run <code>terraform plan</code> #optional, but allows you to preview the deploy.</li><li>Run <code>terraform apply</code>.</li></ol><p>This commands above will create and deploy ORCA. To delete the created objects,
run <code>terraform destroy</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="collection-configuration">Collection Configuration<a class="hash-link" href="#collection-configuration" title="Direct link to heading">​</a></h2><p>To configure a collection to enable ORCA, add the line
<code>&quot;granuleRecoveryWorkflow&quot;: &quot;OrcaRecoveryWorkflow&quot;</code> to the collection configuration
as seen below.</p><p>Optionally, you can exclude files by adding values to an
<code>excludeFileTypes</code> variable as seen below.
In addition, when dealing with large files, the <code>s3MultipartChunksizeMb</code> variable can also be set to override the
default setting set during ORCA installation.
If the file should be stored in a <a href="/cumulus-orca/docs/operator/storage-classes">storage class</a> other than the default set in <code>orca_default_storage_class</code> during installation, specify it using <code>orcaDefaultStorageClassOverride</code>.
For more information, see the documentation on the
<a href="https://github.com/nasa/cumulus-orca/tree/master/tasks/copy_to_glacier" target="_blank" rel="noopener noreferrer"><code>copy_to_glacier</code> task</a>.</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;queriedAt&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2019-11-07T22:49:46.842Z&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;name&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;L0A_HR_RAW&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;version&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;sampleFileName&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;L0A_HR_RAW_product_0001-of-0420.h5&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;dataType&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;L0A_HR_RAW&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;granuleIdExtraction&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;^(.*)((\\.cmr\\.json)|(\\.iso\\.xml)|(\\.tar\\.gz)|(\\.h5)|(\\.h5\\.mp))$&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;reportToEms&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;granuleId&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;^.*$&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;provider_path&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;L0A_HR_RAW/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;meta&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;granuleRecoveryWorkflow&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;OrcaRecoveryWorkflow&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;excludeFileTypes&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;.cmr&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;.xml&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;.met&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;s3MultipartChunksizeMb&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">400</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;orcaDefaultBucketOverride&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;prod_orca_worm&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;orcaDefaultRecoveryTypeOverride&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Standard&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;orcaDefaultStorageClassOverride&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;DEEP_ARCHIVE&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="enable-recover-granule-button">Enable <code>Recover Granule</code> Button<a class="hash-link" href="#enable-recover-granule-button" title="Direct link to heading">​</a></h2><p>To enable the <code>Recover Granule</code> button on the Cumulus Dashboard (available at github.com/nasa/cumulus-dashboard),
set the environment variable <code>ENABLE_RECOVERY=true</code>.</p><p>Here is an sample command to run the Cumulus Dashboard locally.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token assign-left variable" style="color:rgb(191, 199, 213)">APIROOT</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">https://uttm5y1jcj.execute-api.us-west-2.amazonaws.com:8000/dev </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">ENABLE_RECOVERY</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">true </span><span class="token function" style="color:rgb(130, 170, 255)">npm</span><span class="token plain"> run serve</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/nasa/cumulus-orca/edit/develop/website/docs/developer/deployment-guide/deployment-with-cumulus.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_eYIM" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vbeJ"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/cumulus-orca/docs/developer/deployment-guide/deployment-s3-bucket"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Creating the Glacier Bucket</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/cumulus-orca/docs/developer/deployment-guide/deployment-upgrading-orca"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Upgrading ORCA</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#configuring-the-orca-deployment" class="table-of-contents__link toc-highlight">Configuring the ORCA Deployment</a><ul><li><a href="#creating-cumulus-tforcatf" class="table-of-contents__link toc-highlight">Creating <code>cumulus-tf/orca.tf</code></a></li><li><a href="#creating-cumulus-tforca_variablestf" class="table-of-contents__link toc-highlight">Creating <code>cumulus-tf/orca_variables.tf</code></a></li><li><a href="#modifying-cumulus-tfterraformtfvars" class="table-of-contents__link toc-highlight">Modifying <code>cumulus-tf/terraform.tfvars</code></a></li><li><a href="#modifying-cumulus-tfmaintf" class="table-of-contents__link toc-highlight">Modifying cumulus-tf/main.tf</a></li></ul></li><li><a href="#define-the-orca-workflows" class="table-of-contents__link toc-highlight">Define the ORCA Workflows</a><ul><li><a href="#add-the-move-granule-step-to-an-ingest-workflow" class="table-of-contents__link toc-highlight">Add the Move Granule Step to an Ingest Workflow</a></li><li><a href="#add-the-copy-to-glacier-step-to-an-ingest-workflow" class="table-of-contents__link toc-highlight">Add the Copy To Glacier Step to an Ingest Workflow</a></li><li><a href="#modify-the-recovery-workflow-optional" class="table-of-contents__link toc-highlight">Modify the Recovery Workflow (<em>OPTIONAL</em>)</a></li><li><a href="#workflow-failures" class="table-of-contents__link toc-highlight">Workflow Failures</a></li></ul></li><li><a href="#orca-variables" class="table-of-contents__link toc-highlight">ORCA Variables</a><ul><li><a href="#required-variables" class="table-of-contents__link toc-highlight">Required Variables</a></li><li><a href="#optional-variables" class="table-of-contents__link toc-highlight">Optional Variables</a></li></ul></li><li><a href="#orca-module-outputs" class="table-of-contents__link toc-highlight">ORCA Module Outputs</a></li><li><a href="#deploy-orca-with-terraform" class="table-of-contents__link toc-highlight">Deploy ORCA with Terraform</a></li><li><a href="#collection-configuration" class="table-of-contents__link toc-highlight">Collection Configuration</a></li><li><a href="#enable-recover-granule-button" class="table-of-contents__link toc-highlight">Enable <code>Recover Granule</code> Button</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/cumulus-orca/docs/about/introduction/orca-intro">About ORCA</a></li><li class="footer__item"><a class="footer__link-item" href="/cumulus-orca/docs/developer/quickstart/developer-intro">ORCA Developer Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/cumulus-orca/docs/cookbook/cookbook-intro">ORCA Cookbooks</a></li><li class="footer__item"><a class="footer__link-item" href="/cumulus-orca/docs/operator/operator-intro">ORCA Operator Guide</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://wiki.earthdata.nasa.gov/display/CUMULUS/ORCA+Working+Group" target="_blank" rel="noopener noreferrer" class="footer__link-item">ORCA Working Group<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/nasa/cumulus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cumulus Project<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://wiki.earthdata.nasa.gov/display/CUMULUS/Cumulus+Integrators+Working+Group" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cumulus Integrator Working Group<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://wiki.earthdata.nasa.gov/display/CUMULUS/Cumulus+Operator+Working+Group" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cumulus Operator Working Group<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://nasa.github.io/cumulus/docs/cumulus-docs-readme" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cumulus Documentation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/nasa/cumulus-orca" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
<script src="/cumulus-orca/assets/js/runtime~main.f22ddc62.js"></script>
<script src="/cumulus-orca/assets/js/main.76ed4be9.js"></script>
</body>
</html>